<!DOCTYPE html>
<html lang="zh-CN">

<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport"
	content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<meta name="description" content="Heather is an online Markdown Editor">
<meta name="keywords" content="Markdown, Heather, Editor, CodeMirror, Github, Open Source">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

 <style>
 #loading{
	font-size:120px;
	color: #fff;
    margin: 0px;
    text-align: center;
	top:calc(50% - 120px);
	width:100%;
 }
 @media (max-width: 768px){
   #loading{
	font-size:80px;
	top:calc(50% - 80px)
   }    
}

.github-corner {
    border-bottom: 0;
    position: fixed;
    right: 0;
    text-decoration: none;
    top: 0;
	z-index:9999999;
	display:none;
}

@media print{
	.github-corner {
		display:none !important;
	}
}
 </style>
</head>
<body>

<a href="https://github.com/mhlx/heather" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#70B7FD; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

<div id="bg" style="position: absolute;top: 0;left: 0; width: 100vw; height: 100vh;background-color: rgb(40, 33, 28)">
	
</div> 
<div id="loading" style=";position:absolute;left:0;">Heather</div>
<script>
var version = '2.0.alpha.1';
function loadJS(callback) {
    var index = 0;
    var site = document.location.href;
    var resources = [];

    function createResource(type, location, url, code,cb) {
        var obj = document.createElement(type);

        if (type === 'script') {
            if (url) obj.src = url+"?v="+version;
            if (code) obj.text = code;
        } else {
            obj.href = url+"?v="+version;
            obj.rel = 'stylesheet';
        }
		if(cb){
			cb(obj);
		}
        obj.location = location;
        obj.onload = indexCount;
        return obj;
    }

    function sendScript(index) {
        return resources[index].location.appendChild(resources[index]);
    }

    function indexCount() {
        if (index < resources.length) {
            sendScript(index);
            index++;
        } else {
			callback();
		}
    }
	

    resources.push(createResource('link', document.head, 'codemirror/lib/codemirror.css', null,function(ele){
		ele.setAttribute("media",'screen');
	}));
    resources.push(createResource('link', document.head, 'codemirror/addon/scroll/simplescrollbars.css', null,function(ele){
		ele.setAttribute("media",'screen');
	}));
    resources.push(createResource('link', document.head, 'css/markdown.css', null,function(ele){
		ele.setAttribute("media",'all');
	}));
    resources.push(createResource('link', document.head, 'fontawesome-free/css/all.min.css', null,function(ele){
		ele.setAttribute("media",'screen');
	}));
    resources.push(createResource('link', document.head, 'css/style.css', null,function(ele){
		ele.setAttribute("media",'screen');
	}));
    resources.push(createResource('link', document.head, 'css/print.css', null,function(ele){
		ele.setAttribute("media",'print');
	}));
    resources.push(createResource('script', document.body, 'jquery/jquery.min.js?', null));
    resources.push(createResource('script', document.body, 'js/morphdom-umd.min.js', null));
    resources.push(createResource('script', document.body, 'codemirror/lib/codemirror.js', null));
    resources.push(createResource('script', document.body, 'codemirror/addon/mode/overlay.js', null));
    resources.push(createResource('script', document.body, 'codemirror/mode/javascript/javascript.js', null));
    resources.push(createResource('script', document.body, 'codemirror/mode/xml/xml.js', null));
    resources.push(createResource('script', document.body, 'codemirror/mode/markdown/markdown.js', null));
    resources.push(createResource('script', document.body, 'codemirror/mode/gfm/gfm.js', null));
    resources.push(createResource('script', document.body, 'codemirror/addon/selection/mark-selection.js', null));
    resources.push(createResource('script', document.body, 'codemirror/addon/search/searchcursor.js', null));
    resources.push(createResource('script', document.body, 'codemirror/addon/edit/continuelist.js', null));
    resources.push(createResource('script', document.body, 'codemirror/addon/scroll/simplescrollbars.js', null));
    resources.push(createResource('script', document.body, 'sweet2alert/dist/sweetalert2.all.min.js', null));
    resources.push(createResource('script', document.body, 'js/turndown.js', null));
    resources.push(createResource('script', document.body, 'js/turndown-plugin-gfm.js', null));
    resources.push(createResource('script', document.body, 'highlight/highlight.pack.js', null));
    resources.push(createResource('script', document.body, 'js/jquery.touchwipe.min.js', null));
    resources.push(createResource('script', document.body, 'js/md.js', null));
    resources.push(createResource('script', document.body, 'js/heather.js', null));
    resources.push(createResource('script', document.body, 'FileSaver.js', null));
    indexCount();
}
</script>
<script>

	loadJS(function(){
		
		$("#bg").remove();
		$("#loading").remove();
		if(!CodeMirror.browser.mobile){
			$('.github-corner').show();
		}
		
		///service worker for offline editing
		if ('serviceWorker' in navigator) {
		   navigator.serviceWorker.register('sw.js?version='+version, { scope: '/' }).then(function(reg) {
			if(reg.installing) {
			  console.log('Service worker installing');
			} else if(reg.waiting) {
			  console.log('Service worker installed');
			} else if(reg.active) {
			  console.log('Service worker active');
			}
		 
		   }).catch(function(error) {
			console.log('Registration failed with ' + error);
		   });
		}

		
		var config = {
			///upload for testing
			upload_url:'https://putsreq.com/aPamE6UIaFogo0JwhL6N',
			upload_finish:function(resp){
				Swal.fire('仅供测试上传所用，固定返回同一地址')
				return {
					type : 'video',
					url : 'https://www.qyh.me/video2/news/FEE39819-FF07-45DD-8D8D-D85DE04DB7DC.mov',
					poster:'https://www.qyh.me/video2/news/FEE39819-FF07-45DD-8D8D-D85DE04DB7DC.mov/960'
				};
			}
		};
		
		//EditorWrapper.lazyRes to config lazy load res url
		//EditorWrapper.commands default commands here
		
		var wrapper = EditorWrapper.create(config);
		
		wrapper.requestFullScreen();
		
		//https://www.qyh.me/space/web/article/598
		var userAgent = navigator.userAgent;
		if(userAgent.indexOf('Windows NT 10.0') != -1 && userAgent.indexOf('Firefox') != -1){
			var textarea = wrapper.editor.getWrapperElement().querySelector('textarea');
			textarea.style.width = "1000px";
		}
		
		var beforePrintHandler = function(mql) {
			if (mql.matches) {
				wrapper.doRender(false);
			}
		}
		if (window.matchMedia) {
			var mediaQueryList = window.matchMedia('print');
			mediaQueryList.addListener(beforePrintHandler);
		}
		wrapper.onRemove(function(){
			mediaQueryList.removeListener(beforePrintHandler);
		});
		 
		
		
		wrapper.toolbar.addIcon('far fa-question-circle icon',function(){
			$.get('help.md',{},function(data){
				var html = window.md.render(data);
				html  = '<div class="markdown-body" style="text-align:left">' + html + '</html>';
				Swal({width:800,html:html,animation:false})
			})
		});
		
		function getFileName(){
			if(wrapper.backup && wrapper.backup.docName){
				return wrapper.backup.docName;
			}return 'default';
		}
		
		if(!CodeMirror.browser.mobile){
		$("#heather_out").on('contextmenu',function(e){
			var style = 'width:200px;margin-bottom:0.5rem;border: 0;border-radius: .25em;background: initial;background-color: #3085d6;color: #fff;font-size: 1.0625em;margin: .3125em;padding: .625em 2em;font-weight: 500;box-shadow: none;';
			var html = '';
			html += '<div><button style="'+style+'" id="export-markdown">导出markdown</button></div>';
			html += '<div><button style="'+style+'" id="export-html">导出html</button></div>';
			html += '<div><button style="'+style+'" id="export-styled-html">导出Styled Html</button></div>';
			html += '<div><button style="'+style+'" id="export-print">打印</button></div>';
			Swal({
				animation:false,
				html : html
			});
			$("#export-markdown").click(function(){
				var blob = new Blob([wrapper.getValue()], {type: "text/plain;charset=utf-8"});
				saveAs(blob, getFileName() + ".md");
			});
			
			$("#export-html").click(function(){
				var blob = new Blob([wrapper.getHtml()], {type: "text/html;charset=utf-8"});
				saveAs(blob, getFileName() + ".html");
			});
			$("#export-styled-html").click(function(){
			
				$('<div id="styled-container">'+wrapper.getHtml()+'</div>').appendTo($('body'));
				var _html;
				$("#styled-container").find('pre code').each(function(){
					var language = this.getAttribute('class');
					if(language && language.startsWith("language-")){
						var lang = language.split('-')[1];
						if(hljs.getLanguage(lang)){
							this.innerHTML = hljs.highlight(lang, this.textContent, true).value;
						}
					}
				});
				try{
					mermaid.initialize({
						theme: wrapper.theme.mermaid.theme || 'default'
					});
					mermaid.init({}, '#styled-container .mermaid');
				}catch(e){}
				_html = $("#styled-container").html();
				$("#styled-container").remove();
				var html = '<html>\n';
				html += '<head>\n';
				html += '<meta charset="utf-8">';
				html += '<meta http-equiv="X-UA-Compatible" content="IE=edge">';
				html += '<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />';					
				html += '<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css">';
				$.ajax({
					url : 'css/markdown.css',
					dataType: "text",
					async:false,
					success : function (data) {
						html += '<style>\n';
						html += data;
						html += '</style>\n';
					}
				});
				$.ajax({
					url : 'css/print.css',
					dataType: "text",
					async:false,
					success : function (data) {
						html += '<style>\n';
						html += data;
						html += '</style>\n';
					}
				});
				var fun = config.res_hljsTheme || function(hljsTheme) {
					return 'highlight/styles/' + hljsTheme + '.css';
				};
				var customCss = wrapper.theme.customCss;
				if(customCss && $.trim(customCss) != ''){
					html += '<style>\n';
					html += customCss;
					html += '</style>\n';
				}
				$.ajax({
					url : fun(wrapper.theme.hljs.theme),
					dataType: "text",
					async:false,
					success : function (data) {
						html += '<style>\n';
						html += data;
						html += '</style>\n';
					}
				});
				
				
				html += '</head>\n';
				html += '<body>\n';
				html += '<div class="markdown-body">\n'
				html += _html+'\n';
				html += '</div>\n';
				html += '</body>\n';
				html += '</html>';
				var blob = new Blob([html], {type: "text/html;charset=utf-8"});
				saveAs(blob, getFileName() + ".html");
			});
			

			$("#export-print").click(function(){
				if(!CodeMirror.browser.chrome){
					Swal.fire({
					  animation:false,
					  text: "使用最新版的chrome浏览器可以获得更好的效果",
					  type: 'warning',
					  showCancelButton: false,
					  confirmButtonColor: '#3085d6',
					  confirmButtonText: '知道了'
					}).then((result) => {
						Swal.close();
						window.print(); 
					})
				} else {
					Swal.close();
					window.print(); 
				}
			});

			e.preventDefault();
		})
		}
		
	});
</script>
</body>
</html>