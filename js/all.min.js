var EditorWrapper=function(){"use strict";CodeMirror.prototype.renderAllDoc=function(e){this.setOption("readOnly",!0);for(var t=this.getViewport(),n=this.lineCount()-1;t.to<n&&t.to>0;)this.scrollIntoView({line:t.to}),t=this.getViewport();this.scrollIntoView({line:n}),this.scrollIntoView({top:e}),this.setOption("readOnly",!1)},CodeMirror.prototype.unfocus=function(){this.getInputField().blur()},CodeMirror.prototype.selectionStatus=function(){var e={selected:"",startLine:-1,startCh:-1,endLine:-1,endCh:-1,prev:"",next:"",prevLine:"",nextLine:""},t=this.getCursor(!0),n=this.getCursor(!1);e.startLine=t.line,e.endLine=n.line,e.startCh=t.ch,e.endCh=n.ch,e.prevLine=0==t.line?"":this.getLine(t.line-1),e.nextLine=n.line==this.lineCount()-1?"":this.getLine(n.line+1);var r=this.getLine(e.startLine),o=this.getSelection();if(""==o)0==t.ch?e.next=r:(e.prev=r.substring(0,t.ch),e.next=r.substring(t.ch,r.length));else{var i=this.getLine(e.endLine);0==e.startCh?e.prev="":e.prev=r.substring(0,e.startCh),e.endCh==i.length?e.next="":e.next=i.substring(e.endCh,i.length)}return e.selected=o,e},CodeMirror.prototype.getLines=function(e,t){for(var n="",r=e;r<t;r++)n+=this.getLine(r),r<t-1&&(n+="\n");return n},CodeMirror.keyMap.default["Shift-Tab"]="indentLess",CodeMirror.keyMap.default.Tab="indentMore";var e=CodeMirror.keyNames,t=CodeMirror.browser.mac,n=CodeMirror.browser.mobile,r=(CodeMirror.browser.ios,new window.TurndownService({headingStyle:"atx",codeBlockStyle:"fenced",emDelimiter:"*",bulletListMarker:"-",defaultReplacement:function(e,t){return t.isBlock?"\n\n"+t.outerHTML+"\n\n":t.outerHTML}}));r.use(window.turndownPluginGfm.gfm);var o=function(e){var t=(e.originalEvent||e).clipboardData.getData("text/plain");return document.execCommand("insertText",!1,t),!1};function i(e,t){let n,r=Array.prototype.slice.call(t.attributes);for(;n=r.pop();)e.setAttribute(n.nodeName,n.nodeValue)}var a=function(e){return void 0===e};function s(e,t){return a(e)?t:e}function c(e){return(new DOMParser).parseFromString(e,"text/html")}var l=function(){function e(e,t){var n=t.config;this.uploadUrl=n.upload_url,this.fileName=n.upload_fileName||"file",this.beforeUpload=n.upload_before,this.file=e,this.fileUploadFinish=n.upload_finish,this.wrapper=t}return e.prototype.start=function(){var e=this,t=this.wrapper.editor,n=new FormData;n.append(this.fileName,this.file),this.beforeUpload&&this.beforeUpload(n,this.file);var r=new XMLHttpRequest,o=document.createElement("div");o.innerHTML='<div class="heather_progressbar"><div></div><span style="position:absolute;top:0"></span><i class="fas fa-times middle-icon" style="position: absolute;top: 0;right: 0;"><i></div>',o.querySelector("i").addEventListener("click",function(){r.abort()});var i=t.addLineWidget(t.getCursor().line,o,{coverGutter:!1,noHScroll:!0});r.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=parseInt(100*e.loaded/e.total)+"",n=o.querySelector(".heather_progressbar").firstChild;$(n).css({width:t+"%"}),o.querySelector(".heather_progressbar").querySelector("span").textContent=t+"%"}},!1),r.addEventListener("readystatechange",function(n){if(4===this.readyState&&(t.removeLineWidget(i),0!==r.status)){var o=e.fileUploadFinish(r.response);if(o)switch((o.type||"image").toLowerCase()){case"image":t.focus(),t.replaceRange("![]("+o.url+")",e.cursor),t.setCursor({line:e.cursor.line,ch:e.cursor.ch+2});break;case"file":t.focus(),t.replaceRange("[]("+o.url+")",e.cursor),t.setCursor({line:e.cursor.line,ch:e.cursor.ch+1});break;case"video":var a=document.createElement("video");a.setAttribute("controls",""),o.poster&&a.setAttribute("poster",o.poster);var s=o.sources||[];if(s.length>0)for(var c=0;c<s.length;c++){var l=s[c],d=document.createElement("source");d.setAttribute("src",l.src),d.setAttribute("type",l.type),a.appendChild(d)}else a.setAttribute("src",o.url);t.replaceRange(a.outerHTML,e.cursor)}}}),r.open("POST",this.uploadUrl),r.send(n);var a=t.getCursor(!0);this.cursor=a},{create:function(t,n){return new e(t,n)}}}(),d=function(){function e(e,t){var n=e.render_plugins||["footnote","katex","mermaid","anchor","task-lists","sup","sub","abbr"],r=-1!=$.inArray("mermaid",n);this.md=createMarkdownParser({html:!1!==e.render_allowHtml,plugins:n,lineNumber:!0,highlight:function(e,t){if(r&&"mermaid"==t)return'<div class="mermaid-block"><div class="mermaid">'+e+'</div><div class="mermaid-source" style="display:none">'+e+"</div></div>";if(t&&hljs.getLanguage(t))try{return'<pre class="hljs"><code>'+hljs.highlight(t,e,!0).value+"</code></pre>"}catch(e){}}});var o=createMarkdownParser({html:!1!==e.render_allowHtml,plugins:n,lineNumber:!1,highlight:function(e,t){if(r&&"mermaid"==t)return'<div class="mermaid">'+e+"</div>"}});this.md2=o,this.config=e,this.theme=t,this.hasMermaid=r,this.hasKatex=-1!=$.inArray("katex",n)}var t=!1;var n=!1;return e.prototype.getHtml=function(e){return this.md2.render(e)},e.prototype.renderAt=function(e,r,o){var s=c(this.md.render(e));null!=s.querySelector(".mermaid")&&!1!==this.hasMermaid&&function(e,n){if(!t){t=!0,$("<script>").appendTo("body").attr({src:n.res_mermaid_js||"js/mermaid.min.js"});var r=setInterval(function(){try{mermaid.initialize({theme:e.mermaid.theme||"default"}),clearInterval(r),$("#heather_out").find(".mermaid").each(function(){if(null==this.getAttribute("data-processed"))try{mermaid.parse(this.textContent),mermaid.init({},$(this))}catch(e){this.innerHTML="<pre>"+e.str+"</pre>"}})}catch(e){}},20)}}(this.theme,this.config),null!=s.querySelector(".katex")&&!1!==this.hasKatex&&function(e){if(!n){n=!0,$("<link>").appendTo("head").attr({type:"text/css",rel:"stylesheet",href:e.res_katex_css||"katex/katex.min.css"}),$("<script>").appendTo("body").attr({src:e.res_katex_js||"katex/katex.min.js"});var t=setInterval(function(){try{katex.renderToString("",{throwOnError:!1}),clearInterval(t);for(var e=document.getElementById("heather_out").querySelectorAll(".katex"),n=0;n<e.length;n++){var r=e[n],o="SPAN"!=r.tagName;try{r.innerHTML=katex.renderToString(r.textContent,{throwOnError:!1,displayMode:o})}catch(e){console.log(e)}}}catch(e){}},20)}}(this.config),this.config.render_beforeRender&&this.config.render_beforeRender(s);var l=s.body.innerHTML;if(o){var d=document.createElement("div");i(d,r),d.innerHTML=l,morphdom(r,d,{onBeforeElUpdated:function(e,t){if(e.isEqualNode(t))return!1;if(e.classList.contains("mermaid-block")&&t.classList.contains("mermaid-block")){var n=e.getElementsByClassName("mermaid-source")[0],r=t.getElementsByClassName("mermaid-source")[0];if(a(n)||a(r))return!0;if(n.textContent==r.textContent)return i(e,t),!1}return!0}})}else r.innerHTML=l;$("#heather_out").find(".mermaid").each(function(){if(null==this.getAttribute("data-processed"))try{mermaid.parse(this.textContent),mermaid.init({},$(this))}catch(e){window.mermaid&&(this.innerHTML="<pre>"+e.str+"</pre>")}})},{create:function(t,n){return new e(t,n)}}}(),h=function(){function e(e){e.setAttribute("data-toolbar",""),this.element=$(e),this.keepHidden=!1}return e.prototype.hide=function(){this.element.css({visibility:"hidden"}),this.hidden=!0},e.prototype.remove=function(){this.element.remove()},e.prototype.height=function(){return this.element.height()},e.prototype.width=function(){return this.element.width()},e.prototype.length=function(){return this.element[0].childNodes.length},e.prototype.show=function(){this.keepHidden||(this.element.css({visibility:"visible"}),this.hidden=!1)},e.prototype.addItem=function(e){insertItem(this,e,this.items.length)},e.prototype.clear=function(){$(this.element).html("")},e.prototype.insertIcon=function(e,t,r,o){var i=function(e,t){var r=document.createElement("i");return r.setAttribute("class",e),r.setAttribute("style","cursor: pointer;margin-right:20px"),t&&(n?r.addEventListener("click",function(e){e.cancelable&&e.preventDefault(),t(r)}):r.addEventListener("mousedown",function(e){e.cancelable&&e.preventDefault(),t(r)})),r}(e,t);o&&o(i),this.insertElement(i,r)},e.prototype.insertElement=function(e,t){var n=this.element[0];t>=this.length()?n.appendChild(e):t<=0?n.insertBefore(e,n.childNodes[0]):n.insertBefore(e,n.childNodes[t])},e.prototype.addElement=function(e){this.insertElement(e,this.length())},e.prototype.addIcon=function(e,t,n){this.insertIcon(e,t,this.length(),n)},e.prototype.removeElement=function(e){for(var t=this.element[0].childNodes,n=t.length-1;n>=0;n--){var r=t[n];e(r)&&this.element[0].removeChild(r)}},{create:function(t){return new e(t)}}}(),u=function(e){function t(e,t,n){this.editor=e,this.scrollElement=t,this.config=n}var n=function(e,t){return e.querySelector('[data-line="'+t+'"]')},r=function(e){return e.querySelectorAll("[data-line]")};return t.prototype.doSync=function(){var e=function(e,t){var n=[],o=r(t);o.forEach(function(e){n.push(parseInt(e.getAttribute("data-line")))});var i=e.getScrollInfo().top;let s,c;for(let t=0;t<n.length;t++){const r=n[t];if(!(e.heightAtLine(r,"local")<i)){c=r;break}s=r}!a(s)&&a(c)&&(c=parseInt(o[o.length-1].getAttribute("data-end-line")));let l=0;return a(s)||a(c)||s===c||(l=(i-e.heightAtLine(s,"local"))/(e.heightAtLine(c,"local")-e.heightAtLine(s,"local"))),{lastMarker:s,nextMarker:c,percentage:l}}(this.editor,this.scrollElement);let t=0;var o=$(this.scrollElement);let i=o.outerHeight();var s,c,l,d;a(e.lastMarker)||(s=n(this.scrollElement,e.lastMarker),a(s)||(t=s.offsetTop-10)),a(e.nextMarker)||(c=n(this.scrollElement,e.nextMarker)||(l=this.scrollElement,d=e.nextMarker,l.querySelector('[data-end-line="'+d+'"]')),a(c)||(i=c.offsetTop-10));var h=i-t;a(s)||a(c)||s!==c||(h=s.clientHeight);var u=this.config.sync_animateMs||0;const f=t+h*e.percentage;o.stop(!0),o.animate({scrollTop:f},u)},{create:function(e,n,r){return new t(e,n,r)}}}(),f=function(){var e=function(){function e(e){$('<div id="heather_hljs_tip" style="visibility:hidden;position:absolute;z-index:99;overflow:auto;background-color:#fff"></div>').appendTo($("#heather_in"));var t={running:!1,cursor:void 0,hideOnNextChange:!1},r=$("#heather_hljs_tip");r.on("click","tr",function(){i($(this))});var o,i=function(n){var r=n.text(),o=e.getCursor(),i=e.getLine(o.line);e.setSelection({line:o.line,ch:4},{line:o.line,ch:i.length}),e.replaceSelection(r),a(),t.hideOnNextChange=!0},a=function(){r.css({visibility:"hidden"}),n||e.removeKeyMap(s),t.running=!1,t.cursor=void 0},s={Up:function(){var e=r.find(".selected"),t=e.prev("tr");t.length>0&&(e.removeClass("selected"),t.addClass("selected"),t[0].scrollIntoView())},Down:function(){var e=r.find(".selected"),t=e.next("tr");t.length>0&&(e.removeClass("selected"),t.addClass("selected"),t[0].scrollIntoView())},Enter:function(e){i(r.find(".selected"))},Esc:function(e){a()}},c=hljs.listLanguages();this.hideTipOnCursorChange=function(e){if(""==e.getSelection()){var n=e.getCursor();n.ch<5?a():(t.cursor||{line:-1}).line!=n.line&&a()}else a()},this.hideTipOnScroll=function(){a()},this.tipHandler=function(e){if(""==e.getSelection()){var i=e.getCursor();i.ch>=5&&(o&&clearTimeout(o),o=setTimeout(function(){var o=e.getLine(i.line);if(o.startsWith("``` ")){for(var l=o.substring(4,i.ch).trimStart(),d=[],h=0;h<c.length;h++){var u=c[h];-1!=u.indexOf(l)&&d.push(u)}if(d.length>0){if(t.hideOnNextChange)return void(t.hideOnNextChange=!1);t.running=!0,t.cursor=i;var f='<table style="width:100%">';for(h=0;h<d.length;h++){f+='<tr class="'+(0==h?"selected":"")+'"><td >'+d[h]+"</td></tr>"}f+="</table>";var p=e.cursorCoords(!0);r.html(f);var m=r.height();$("#heather_in").height()-p.top<m+e.defaultTextHeight()?r.css({top:p.top-m,left:p.left,visibility:"visible"}):r.css({top:p.top+e.defaultTextHeight(),left:p.left,visibility:"visible"}),n||e.addKeyMap(s)}else a()}else a()},100))}else a()},this.editor=e}return e.prototype.enable=function(){this.editor.on("change",this.tipHandler),this.editor.on("cursorActivity",this.hideTipOnCursorChange),this.editor.on("scroll",this.hideTipOnScroll),this.editor.on("touchmove",this.hideTipOnScroll)},e.prototype.disable=function(){this.editor.off("change",this.tipHandler),this.editor.off("cursorActivity",this.hideTipOnCursorChange),this.editor.off("scroll",this.hideTipOnScroll),this.editor.off("touchmove",this.hideTipOnScroll)},{create:function(t){return new e(t)}}}();function t(t){this.hljsTip=e.create(t)}return t.prototype.enable=function(){this.hljsTip.enable()},{create:function(e){return new t(e)}}}(),p=function(){function e(e){this.wrapper=e,this.key=e.config.backup_key||"heather-documents";var t=this;e.editor.on("change",function(){t.autoSaveTimer&&clearTimeout(t.autoSaveTimer),t.autoSaveTimer=setTimeout(function(){var n=e.getValue();""!=n&&(t.docName?t.addDocument(t.docName,n):t.addDocument("default",n))},s(e.config.backup_autoSaveMs,500))}),e.onRemove(function(){t.wrapper=null,t.autoSaveTimer&&clearTimeout(t.autoSaveTimer)}),e.eventHandlers.push({name:"load",handler:function(){setTimeout(function(){t.loadLastDocument()},100)}})}function t(e,t){if(null!=t){"default"!=t.title?e.docName=t.title:e.docName=void 0;var n=e.wrapper;n.setValue(t.content),!1!==n.syncEnable&&!1!==n.config.renderAllDocEnable&&n.editor.renderAllDoc(0)}}function n(e,t){for(var n=e.length-1;n>=0;n--)if(e[n].title==t){e.splice(n,1);break}}function r(e,t){var n=JSON.stringify(t);localStorage.setItem(e,n)}return e.prototype.addDocument=function(e,t){var o=this.getDocuments();n(o,e),o.push({title:e,content:t,time:$.now()}),r(this.key,o)},e.prototype.deleteDocument=function(e){var t=this.getDocument(e);null!=t&&this.docName==t.title&&this.newDocument();var o=this.getDocuments();n(o,e),r(this.key,o)},e.prototype.getDocument=function(e){for(var t=this.getDocuments(),n=t.length-1;n>=0;n--)if(t[n].title==e)return t[n];return null},e.prototype.getDocuments=function(){var e=localStorage.getItem(this.key);return null==e?[]:$.parseJSON(e)},e.prototype.getLastDocument=function(){var e=this.getDocuments();return e.sort(function(e,t){var n=e.time,r=t.time;return n>r?-1:n==r?0:1}),e.length>0?e[0]:null},e.prototype.loadLastDocument=function(){t(this,this.getLastDocument())},e.prototype.loadDocument=function(e){t(this,this.getDocument(e))},e.prototype.newDocument=function(){this.docName=void 0,this.wrapper.setValue("")},e.prototype.backup=function(){if(this.docName)this.addDocument(this.docName,this.wrapper.getValue()),this.deleteDocument("default"),swal("保存成功");else{var e=this;!async function(){const{value:t}=await Swal.fire({title:"标题",input:"text",showCancelButton:!0});t&&(e.addDocument(t,e.wrapper.getValue()),e.docName=t,e.deleteDocument("default"),swal("保存成功"))}()}},{create:function(t){return new e(t)}}}(),m=function(){function e(e){this.key=e.theme_key||"heather-theme",this.store={save:function(e,t){localStorage.setItem(e,t)},get:function(e){return localStorage.getItem(e)}},this.config=e,this.timer=void 0}function t(e){this.toolbar={},this.bar={},this.stat={},this.editor={},this.inCss={},this.searchHelper={},this.cursorHelper={},this.mermaid={},this.hljs={theme:"github"},this.customCss=void 0,this.timer=void 0,this.config=e}function n(e,t){if(e.editor.theme){var n=e.editor.theme,r=e.config.res_editorTheme||function(e){return"codemirror/theme/"+e+".css"};0==$("#codemirror-theme-"+n).length?$('<link id="codemirror-theme-'+n+'" >').appendTo("head").attr({type:"text/css",rel:"stylesheet",onload:function(){t&&t(n)},href:r(n)}):t&&t(n)}}return e.prototype.saveTheme=function(e){this.timer&&clearTimeout(this.timer);var t=this;this.timer=setTimeout(function(){var n=JSON.stringify(e);t.store.save(t.key,n)},500)},e.prototype.reset=function(){var e=new t(this.config);return this.store.save(this.key,JSON.stringify(e)),e.render(),e},e.prototype.getTheme=function(){var e=this.store.get(this.key);if(null==e)return new t(this.config);var n=$.parseJSON(e),r=new t(this.config);return r.toolbar=n.toolbar||{},r.bar=n.bar||{},r.stat=n.stat||{},r.editor=n.editor||{},r.inCss=n.inCss,r.searchHelper=n.searchHelper||{},r.cursorHelper=n.cursorHelper||{},r.mermaid=n.mermaid||{},r.customCss=n.customCss,r},t.prototype.clone=function(){var e=JSON.parse(JSON.stringify(this)),n=new t(this.config);return n.toolbar=e.toolbar||{},n.bar=e.bar||{},n.stat=e.stat||{},n.editor=e.editor||{},n.inCss=e.inCss,n.editor=e.editor||{},n.searchHelper=e.searchHelper||{},n.cursorHelper=e.cursorHelper||{},n.mermaid=e.mermaid||{},n.customCss=e.customCss,n},t.prototype.setEditorTheme=function(e,t,r){this.editor.theme=t;var o=this;n(this,function(){var n=document.createElement("div");n.classList.add("cm-s-"+t),document.body.appendChild(n);var i=window.getComputedStyle(n,null).getPropertyValue("background-color");document.body.removeChild(n),e.setOption("theme",t),o.inCss.background=i,r&&r()})},t.prototype.render=function(){n(this),function(e){if(e.hljs.theme){var t=e.hljs.theme,n=e.config.res_hljsTheme||function(e){return"highlight/styles/"+e+".css"};0==$("#hljs-theme-"+t).length&&$('<link id="hljs-theme-'+t+'" >').appendTo("head").attr({type:"text/css",rel:"stylesheet",href:n(t)})}}(this);var e="";e+="#heather_toolbar{color:"+(this.toolbar.color||"inherit")+"}\n",e+="#heather_innerBar{color:"+(this.bar.color||"inherit")+"}\n",e+="#heather_stat{color:"+(this.stat.color||"inherit")+"}\n",e+="#heather_in{background:"+(this.inCss.background||"inherit")+"}\n",e+="#heather_cursorHelper{color:"+(this.cursorHelper.color||"inherit")+"}\n";var t=this.searchHelper.color||"inherit";e+="#heather_searchHelper{color:"+t+"}\n#heather_searchHelper .form-control{color:"+t+"}\n#heather_searchHelper .input-group-text{color:"+t+"}\n#heather_searchHelper .form-control::placeholder {color: "+t+";opacity: 1;}\n#heather_searchHelper .form-control::-ms-input-placeholder {color: "+t+";}\n#heather_searchHelper .form-control::-ms-input-placeholder {color: "+t+";}",$("#custom_theme").remove(),""!=$.trim(e)&&$("head").append("<style type='text/css' id='custom_theme'>"+e+"</style>"),$("#custom_css").remove(),$("head").append("<style type='text/css' id='custom_css'>"+(this.customCss||"")+"</style>")},{create:function(t){return new e(t)}}}(),v=function(){function e(e){$("#heather_out").on("click",".task-list-item",function(t){for(var n=t.target;!n.classList.contains("contains-task-list");)n=n.parentElement;for(var o=t.target;!o.classList.contains("task-list-item");)o=o.parentElement;e.editor.setOption("readOnly",!0);var a=parseInt(n.getAttribute("data-line")),s=parseInt(n.getAttribute("data-end-line")),l=e.editor.getLines(a,s);if(null==c(l).body.querySelector(".contains-task-list")){var d=c(e.render.getHtml(l)).body.firstChild;if(i(d,n),d.isEqualNode(n)){var h=o.querySelector('input[type="checkbox"]');h.checked?h.removeAttribute("checked"):h.setAttribute("checked","checked");var u=c(n.outerHTML).body.firstChild,f=r.turndown(u.outerHTML);e.editor.replaceRange(f,{line:a,ch:0},{line:s-1}),e.doRender(!0)}e.editor.setOption("readOnly",!1)}else e.editor.setOption("readOnly",!1)})}return{create:function(t){return new e(t)}}}(),g=function(){function e(e,r){var o=this;this.composing=!1;var i=document.createElement("div");i.setAttribute("class","heather_contenteditable_bar"),document.body.appendChild(i),i=h.create(i);var a="heather_status_on";i.addIcon("fas fa-bold middle-icon",void 0,function(e){var t=n?"touchstart":"mousedown";e.addEventListener(t,function(){document.execCommand("bold"),document.queryCommandState("bold")?e.classList.add(a):e.classList.remove(a)}),o.boldBtn=e}),i.addIcon("fas fa-italic middle-icon",void 0,function(e){var t=n?"touchstart":"mousedown";e.addEventListener(t,function(){document.execCommand("italic"),document.queryCommandState("italic")?e.classList.add(a):e.classList.remove(a)}),o.italicBtn=e}),i.addIcon("fas fa-strikethrough middle-icon",void 0,function(e){var t=n?"touchstart":"mousedown";e.addEventListener(t,function(){document.execCommand("strikeThrough"),document.queryCommandState("strikeThrough")?e.classList.add(a):e.classList.remove(a)}),o.strikeThroughBtn=e}),i.addIcon("fas fa-code middle-icon",void 0,function(e){var t=n?"touchstart":"mousedown";e.addEventListener(t,function(){var e=window.getSelection().toString();e.length>0&&document.execCommand("insertHTML",!1,"<code>"+e+"</code>")})}),i.addIcon("fas fa-eraser middle-icon",void 0,function(e){var t=n?"touchstart":"mousedown";e.addEventListener(t,function(){window.getSelection().toString().length>0&&document.execCommand("removeFormat")})});var s=function(e){o.composing=!0},c=function(e){o.composing=!1},l=function(){var e=window.getSelection();if(0==o.composing&&"Range"==e.type&&e.rangeCount>0)for(var s=e.getRangeAt(0).commonAncestorContainer;null!=s;){if(s==r){var c=t(),l=c.top-80-i.height()-$(window).scrollTop();i.element.css({top:l<0?c.top+c.height+30:l+$(window).scrollTop()+"px"}),n||(i.width()+c.left>$(window).width()?i.element.css({right:"30px"}):i.element.css({left:c.left+"px"})),i.show();break}s=s.parentElement}else i.hide();document.queryCommandState("bold")?o.boldBtn.classList.add(a):o.boldBtn.classList.remove(a),document.queryCommandState("italic")?o.italicBtn.classList.add(a):o.italicBtn.classList.remove(a),document.queryCommandState("strikeThrough")?o.strikeThroughBtn.classList.add(a):o.strikeThroughBtn.classList.remove(a)};e.selectionChangeListeners.push(l),r.addEventListener("compositionstart",s),r.addEventListener("compositionend",c),this.startHandler=s,this.endHandler=c,this.bar=i,this.selectionChangeListener=l,this.element=r,this.wrapper=e}function t(){var e=window.getSelection().getRangeAt(0).getBoundingClientRect(),t=document.body,n=document.documentElement,r=window.pageYOffset||n.scrollTop||t.scrollTop,o=window.pageXOffset||n.scrollLeft||t.scrollLeft,i=n.clientTop||t.clientTop||0,a=n.clientLeft||t.clientLeft||0,s=e.top+r-i,c=e.left+o-a;return{top:Math.round(s),left:Math.round(c),height:Math.round(e.height)}}return e.prototype.remove=function(){for(var e=this.wrapper.selectionChangeListeners,t=0;t<e.length;t++)if(e[t]==this.selectionChangeListener){e.splice(t,1);break}this.bar.remove(),this.element.removeEventListener("compositionstart",this.startHandler),this.element.removeEventListener("compositionend",this.endHandler)},{create:function(t,n){return new e(t,n)}}}(),b=function(){function e(e){this.oneTimeHandlers=[],$("#heather_out").on("click","table",function(n){for(var r=n.target;null!=r&&"TABLE"!=r.tagName;)r=r.parentElement;if(null!=r){var o=parseInt(r.getAttribute("data-line")),s=parseInt(r.getAttribute("data-end-line")),l=e.editor.getLines(o,s);if(null==c(l).body.querySelector("table")){if(a(this.tableSession)||!0===this.tableSession.closed){var d=c(e.render.getHtml(l)).body.firstChild;i(d,r),d.isEqualNode(r)&&(this.tableSession=new t(e,r,o,s),this.tableSession.start())}}else e.editor.setOption("readOnly",!1)}})}function t(e,t,n,r){this.wrapper=e,this.table=t,this.line=n,this.endLine=r}function s(e,t,n){var r=t.index();e.find("tr").each(function(){$(this).children().eq(r).css({"text-align":n})})}function l(e,t,n){var r=t.index();e.find("tr").each(function(){var e=$(this),t=e.find("td").eq(r),o=e.find("th").eq(r);n?(o.after("<th></th>"),t.after("<td></td>")):(o.before("<th></th>"),t.before("<td></td>"))})}function d(e,t,n){if("TH"!=t[0].tagName||n){var r=t.parent(),o=r.find("td").length;0==o&&(o=r.find("th").length);for(var i="<tr>",a=0;a<o;a++)i+="<td></td>";i+="</tr>",n?r.after(i):r.before(i)}}t.prototype.start=function(){var e=this;this.wrapper.editor.setOption("readOnly",!0),this.wrapper.disableRender=!0,this.clickHandler=function(t){var n=function e(t){if(null==t)return null;if("TD"==t.tagName||"TH"==t.tagName)return t;return e(t.parentElement)}(t.target);n.isContentEditable||(e.contenteditableBar&&e.contenteditableBar.remove(),$(e.table).find("[contenteditable]").each(function(){this.removeEventListener("paste",o),this.removeAttribute("contenteditable")}),n.addEventListener("paste",o),n.setAttribute("contenteditable",!0),e.contenteditableBar=g.create(e.wrapper,n)),e.td=n},$(this.table).on("click","th,td",this.clickHandler);var t=document.createElement("div");t.setAttribute("style","margin-bottom:10px;margin-top:5px"),this.table.before(t),(t=h.create(t)).addIcon("fas fa-trash middle-icon",function(){Swal.fire({title:"确定要删除表格?",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33"}).then(t=>{t.value&&($(e.table).remove(),e.close())})}),t.addIcon("fas fa-plus middle-icon",function(){if(e.td){var t=$(e.td),n=$(e.table),r="width:200px;margin-bottom:0.5rem;border: 0;border-radius: .25em;background: initial;background-color: #3085d6;color: #fff;font-size: 1.0625em;margin: .3125em;padding: .625em 2em;font-weight: 500;box-shadow: none;";'<div><button style="'+r+'" >向右添加列</button></div>','<div><button style="'+r+'" >向左添加列</button></div>','<div><button style="'+r+'" >向上添加行</button></div>','<div><button style="'+r+'" >向下添加行</button></div>',Swal({animation:!1,html:'<div><button style="width:200px;margin-bottom:0.5rem;border: 0;border-radius: .25em;background: initial;background-color: #3085d6;color: #fff;font-size: 1.0625em;margin: .3125em;padding: .625em 2em;font-weight: 500;box-shadow: none;" >向右添加列</button></div><div><button style="width:200px;margin-bottom:0.5rem;border: 0;border-radius: .25em;background: initial;background-color: #3085d6;color: #fff;font-size: 1.0625em;margin: .3125em;padding: .625em 2em;font-weight: 500;box-shadow: none;" >向左添加列</button></div><div><button style="width:200px;margin-bottom:0.5rem;border: 0;border-radius: .25em;background: initial;background-color: #3085d6;color: #fff;font-size: 1.0625em;margin: .3125em;padding: .625em 2em;font-weight: 500;box-shadow: none;" >向上添加行</button></div><div><button style="width:200px;margin-bottom:0.5rem;border: 0;border-radius: .25em;background: initial;background-color: #3085d6;color: #fff;font-size: 1.0625em;margin: .3125em;padding: .625em 2em;font-weight: 500;box-shadow: none;" >向下添加行</button></div>'});var o=$(Swal.getContent()).find("button");o.eq(0).click(function(){l(n,t,!0),Swal.close()}),o.eq(1).click(function(){l(n,t,!1),Swal.close()}),o.eq(2).click(function(){d(n,t,!1),Swal.close()}),o.eq(3).click(function(){d(n,t,!0),Swal.close()})}}),t.addIcon("fas fa-minus middle-icon",function(){if(e.td){var t=$(e.td),n=$(e.table),r="width:200px;margin-bottom:0.5rem;border: 0;border-radius: .25em;background: initial;background-color: #3085d6;color: #fff;font-size: 1.0625em;margin: .3125em;padding: .625em 2em;font-weight: 500;box-shadow: none;";'<div><button style="'+r+'" >删除当前行</button></div>','<div><button style="'+r+'" >删除当前列</button></div>',Swal({animation:!1,html:'<div><button style="width:200px;margin-bottom:0.5rem;border: 0;border-radius: .25em;background: initial;background-color: #3085d6;color: #fff;font-size: 1.0625em;margin: .3125em;padding: .625em 2em;font-weight: 500;box-shadow: none;" >删除当前行</button></div><div><button style="width:200px;margin-bottom:0.5rem;border: 0;border-radius: .25em;background: initial;background-color: #3085d6;color: #fff;font-size: 1.0625em;margin: .3125em;padding: .625em 2em;font-weight: 500;box-shadow: none;" >删除当前列</button></div>'});var o=$(Swal.getContent()).find("button");o.eq(0).click(function(){!function(e,t){if("TH"==t[0].tagName)return;if(2==e.find("tr").length)return;t.parent().remove()}(n,t),Swal.close()}),o.eq(1).click(function(){!function(e,t){if(1==e.find("tr").eq(0).find("th").length)return;var n=t.index();e.find("tr").each(function(){var e=$(this),t=e.find("td").eq(n);t.length>0&&t.remove();var r=e.find("th").eq(n);r.length>0&&r.remove()})}(n,t),Swal.close()})}}),t.addIcon("fas fa-align-left middle-icon",function(){e.td&&s($(e.table),$(e.td),"left")}),t.addIcon("fas fa-align-center middle-icon",function(){e.td&&s($(e.table),$(e.td),"center")}),t.addIcon("fas fa-align-right middle-icon",function(){e.td&&s($(e.table),$(e.td),"right")}),t.addIcon("fas fa-check middle-icon",function(){e.close()}),this.toolbar=t},t.prototype.close=function(){var e=$(this.table);e.off("click","th,td",this.clickHandler),this.toolbar.remove(),e.find("[contenteditable]").each(function(){this.removeEventListener("paste",o),this.removeAttribute("contenteditable")}),this.contentEditableBar&&this.contentEditableBar.remove(),this.wrapper.editor.setOption("readOnly",!1),this.wrapper.disableRender=!1;var t="";if(-1!=e.index()){var r=c(e[0].outerHTML).body.firstChild;t=function(e){for(var t="",n=e.find("tr"),r=0;r<n.length;r++){var o=n.eq(r),i=o.find("th"),a=i.length>0;if(a){t+=f(i),t+="\n";for(var s=0;s<i.length;s++){var c=i[s].style["text-align"];t+="|"+u[c]}t+="|"}else t+=f(o.find("td"));r<n.length-1&&(t+="\n")}return t}($(r))}this.wrapper.editor.replaceRange(t,{line:this.line,ch:0},{line:this.endLine-1}),n&&this.wrapper.doRender(!0),this.closed=!0};var u={"":" -- ",left:" :-- ",center:" :--: ",right:" --: "};function f(e){for(var t="",n=0;n<e.length;n++){var o=e.eq(n);t+="|";var i=r.turndown(o.html());t+=(i=i.trim().replace(/\n\r/g,"<br>").replace(/\n/g,"<br>")).length<3?"  "+i:i}return t+="|"}return{create:function(t){return new e(t)}}}(),y=function(){var t=function(){function e(e){this.cm=e}function t(e){return e.state.search||(e.state.search=new o)}function n(e){return"string"==typeof e&&e==e.toLowerCase()}function r(e,t,r){return e.getSearchCursor(t,r,{caseFold:n(t),multiline:!0})}function o(){this.posFrom=this.posTo=this.lastQuery=this.query=null,this.overlay=null}return e.prototype.startSearch=function(e,r){var o=this.cm;this.clearSearch();var i=t(o);i.queryText=e,i.query=function(e){if(""==e)return e;var t=e.match(/^\/(.*)\/([a-z]*)$/);if(t)try{e=new RegExp(t[1],-1==t[2].indexOf("i")?"":"i")}catch(e){}else e=e.replace(/\\([nrt\\])/g,function(e,t){return"n"==t?"\n":"r"==t?"\r":"t"==t?"\t":"\\"==t?"\\":e});("string"==typeof e?""==e:e.test(""))&&(e=/x^/);return e}(e),o.removeOverlay(i.overlay,n(i.query)),this.findNext(!1,r)},e.prototype.clearSearch=function(){for(var e=this.cm,n=e.getAllMarks(),r=0;r<n.length;r++)n[r].clear();e.operation(function(){var n=t(e);n.lastQuery=n.query,n.query&&(n.query=n.queryText=null,e.removeOverlay(n.overlay),n.annotate&&(n.annotate.clear(),n.annotate=null))})},e.prototype.findNext=function(e,n){var o=this.cm,i=t(o);i.query&&o.operation(function(){var t=r(o,i.query,e?i.posFrom:i.posTo);if(t.find(e)||(t=r(o,i.query,e?CodeMirror.Pos(o.lastLine()):CodeMirror.Pos(o.firstLine(),0))).find(e)){o.setSelection(t.from(),t.to());for(var a=o.getAllMarks(),s=0;s<a.length;s++)a[s].clear();o.markText(t.from(),t.to(),{className:"styled-background"});var c=o.cursorCoords(t.from(),"local");o.scrollTo(0,c.top),i.posFrom=t.from(),i.posTo=t.to(),n&&n({from:t.from(),to:t.to()})}else n&&n(null)})},e.prototype.replace=function(e){var n=this.cm,o=t(n);if(o.query){var i=r(n,o.query,n.getCursor("from"));!function(){var t=i.from();if(i.findNext()||(i=r(n,o.query)).findNext()&&(!t||i.from().line!=t.line||i.from().ch!=t.ch)){n.setSelection(i.from(),i.to());var a=n.cursorCoords(i.from(),"local");n.scrollTo(0,a.top),i.replace("string"==typeof query?e:e.replace(/\$(\d)/g,function(e,t){}))}}()}},e.prototype.replaceAll=function(e){var n=this.cm,o=t(n);if(o.query){var i=o.query;n.operation(function(){for(var t=r(n,i);t.findNext();)if("string"!=typeof i){var o=n.getRange(t.from(),t.to()).match(i);t.replace(e.replace(/\$(\d)/g,function(e,t){return o[t]}))}else t.replace(e)})}},{create:function(t){return new e(t)}}}();function n(n){var r=$('<div id="heather_searchHelper" style="position:absolute;bottom:10px;width:100%;z-index:99;display:none;padding:20px;padding-bottom:5px"><div style="width:100%;text-align:right;margin-bottom:5px"><i class="fas fa-times icon"  style="cursor:pointer;margin-right:0px"></i></div> <form><div class="input-group mb-3"><input type="text" style="border:none" class="form-control" placeholder="查找内容" ><div class="input-group-append" data-search> <span class="input-group-text" ><i class="fas fa-search " style="cursor:pointer"></i></span> </div></div><div class="input-group mb-3" style="display:none"><input type="text" style="border:none" class="form-control" placeholder="替换内容" ><div class="input-group-append" data-replace style="cursor:pointer"> <span class="input-group-text" ><i class="fas fa-exchange-alt" ></i></span> </div><div class="input-group-append" data-replace-all style="cursor:pointer"> <span class="input-group-text" ><i class="fas fa-sync-alt" ></i></span> </div><div class="input-group-append" data-up style="cursor:pointer"> <span class="input-group-text" ><i class="fas fa-arrow-up" ></i></span> </div><div class="input-group-append" data-down style="cursor:pointer"> <span class="input-group-text" ><i class="fas fa-arrow-down" ></i></span> </div></div></form></div>');$("#heather_in").append(r);var o=t.create(n),i=function(){o.findNext(!1)},a=function(){o.findNext(!0)};this.keyMap={Up:a,Down:i};var s=function(){var e=r.find("input").eq(0).val();""!=$.trim(e)?o.startSearch(e,function(e){null==e?swal("没有找到符合条件的搜索内容"):(r.find(".input-group").eq(0).hide(),r.find(".input-group").eq(1).show(),n.focus())}):swal("搜索内容不能为空")},c=function(){var e=r.find("input").eq(1).val();o.replace(e)};r.find(".form-control").eq(0).on("keydown",function(t){"Enter"==e[t.keyCode]&&(s(),t.preventDefault())}),r.find(".form-control").eq(1).on("keydown",function(t){"Enter"==e[t.keyCode]&&(c(),t.preventDefault())}),r.on("click","[data-search]",s),r.on("click","[data-down]",i),r.on("click","[data-up]",a),r.on("click","[data-replace]",c),r.on("click","[data-replace-all]",function(){Swal.fire({title:"确定要替换全部吗?",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33"}).then(e=>{if(e.value){var t=r.find("input").eq(1).val();o.replaceAll(t)}})});var l=this;r.on("click",".fa-times",function(){l.close()}),this.ele=r,this.visible=!1,this.editor=n,this.searchUtil=o}return n.prototype.open=function(){this.editor.setOption("readOnly",!0),this.ele.show(),this.ele.find(".form-control").focus(),this.visible=!0,this.editor.addKeyMap(this.keyMap)},n.prototype.close=function(){this.searchUtil.clearSearch(),this.ele.hide(),this.ele.find("input").val(""),this.ele.find(".input-group").eq(0).show(),this.ele.find(".input-group").eq(1).hide(),this.editor.setOption("readOnly",!1),this.visible=!1,this.editor.removeKeyMap(this.keyMap)},n.prototype.isVisible=function(){return this.visible},{create:function(e){return new n(e)}}}(),w=function(){var e=function(){function e(e){this.from=e.getCursor("from"),this.to=e.getCursor("to"),this.movedByMouseOrTouch=!1;var t=this;this.cursorActivityHandler=function(){t.movedByMouseOrTouch&&(t.mark&&t.mark.clear(),t.movedByMouseOrTouch=!1,t.from=e.getCursor("from"),t.to=e.getCursor("to"))},this.movedHandler=function(){t.movedByMouseOrTouch=!0},this.editor=e}return e.prototype.init=function(){this.mark&&this.mark.clear(),this.editor.on("cursorActivity",this.cursorActivityHandler),this.editor.on("mousedown",this.movedHandler),this.editor.on("touchstart",this.movedHandler)},e.prototype.move=function(e){var t=this.editor;t.setCursor(this.to),t.execCommand(e),this.to=t.getCursor("from"),this.mark&&this.mark.clear(),this.from.line>this.to.line||this.from.line==this.to.line&&this.from.ch>this.to.ch?this.mark=t.markText(this.to,this.from,{className:"styled-background"}):this.mark=t.markText(this.from,this.to,{className:"styled-background"})},e.prototype.end=function(){this.mark&&this.mark.clear();var e=this.editor;e.on("cursorActivity",this.cursorActivityHandler),e.on("mousedown",this.movedHandler),e.on("touchstart",this.movedHandler),this.from.line>this.to.line||this.from.line==this.to.line&&this.from.ch>this.to.ch?e.setSelection(this.to,this.from):e.setSelection(this.from,this.to),e.focus()},{create:function(t){return new e(t)}}}();function t(t){var n=$('<div id="heather_cursorHelper" style="position:absolute;bottom:5px;width:150px;left:calc(50% - 75px);display:none;z-index:9999" class="alpha30" ><div style="height:26.66%;padding:5px;cursor:pointer"><i class="fas fa-times"  style="font-size:35px" title="关闭"></i><div style="clear:both"></div></div><div style="height:26.66%;text-align:center"><i class="fas fa-arrow-up" data-arrow="goLineUp" style="font-size:50px;cursor:pointer"></i></div><div style="height:26.66%"><i class="fas fa-arrow-left" data-arrow="goCharLeft" style="font-size:50px;float:left;cursor:pointer;margin-right:20px"></i><i class="fas fa-arrow-right" data-arrow="goCharRight" style="font-size:50px;float:right;cursor:pointer"></i><div style="clear:both"></div></div><div style="height:26.66%;text-align:center"><i class="fas fa-arrow-down" data-arrow="goLineDown" style="font-size:50px;cursor:pointer"></i></div></div>');$("#heather_in").append(n);var r=e.create(t);n.on("click","[data-arrow]",function(){var e=$(this).data("arrow");r.move(e)});var o=this;n.on("click",".fa-times",function(){o.close()}),this.editor=t,this.ele=n,this.cursorUtil=r}return t.prototype.open=function(){this.editor.setOption("readOnly",!0),this.cursorUtil.init(),this.ele.show()},t.prototype.close=function(){this.ele.hide(),this.editor.setOption("readOnly",!1),this.cursorUtil.end()},{create:function(e){return new t(e)}}}();return function(){function e(){this.wrapperInstance={},this.commands={emoji:function(e){for(var t=e.editor,n=$.trim("😀 😁 😂 🤣 😃 😄 😅 😆 😉 😊 😋 😎 😍 😘 😗 😙 😚 ☺️ 🙂 🤗 🤔 😐 😑 😶 🙄 😏 😣 😥 😮 🤐 😯 😪 😫 😴 😌 😛 😜 😝 🤤 😒 😓 😔 😕 🙃 🤑 😲 ☹️ 🙁 😖 😞 😟 😤 😢 😭 😦 😧 😨 😩 😬 😰 😱 😳 😵 😡 😠 😷 🤒 🤕 🤢 🤧 😇 🤠 🤡 🤥 🤓 😈 👿 👹 👺 💀 👻 👽 🤖 💩 😺 😸 😹 😻 😼 😽 🙀 😿 😾").split(" "),r="",o=0;o<n.length;o++)r+='<span data-emoji style="cursor:pointer">'+n[o]+"</span>";swal({html:r}),$(Swal.getContent()).find("[data-emoji]").click(function(){var e=$(this).text();""==t.getSelection()?t.replaceRange(e,t.getCursor()):t.replaceSelection(e),Swal.close()})},heading:function(e){var t=e.editor;!async function(){const{value:e}=await Swal.fire({input:"select",inputValue:"1",inputOptions:{1:"H1",2:"H2",3:"H3",4:"H4",5:"H5",6:"H6"},inputPlaceholder:"",showCancelButton:!0});if(e){var n=parseInt(e),r=t.selectionStatus();i(r,function(e){for(var t="",r=0;r<n;r++)t+="#";return(t+=" ")+e}),""==r.selected?(t.replaceRange(r.text,t.getCursor()),t.focus(),t.setCursor({line:r.startLine,ch:n+1})):t.replaceSelection(r.text)}}()},bold:function(e){var t=e.editor,n=t.getSelection();if(""==n){t.replaceRange("****",t.getCursor()),t.focus();var r="**".length,o=t.getCursor(),i=o.line,a=o.ch;t.setCursor({line:i,ch:a-r})}else t.replaceSelection("**"+n+"**")},italic:function(e){var t=e.editor,n=t.getSelection();if(""==n){t.replaceRange("**",t.getCursor()),t.focus();var r="*".length,o=t.getCursor(),i=o.line,a=o.ch;t.setCursor({line:i,ch:a-r})}else t.replaceSelection("*"+n+"*")},quote:function(e){var t=e.editor,n=t.selectionStatus();i(n,function(e){return"> "+e}),""==n.selected?(t.replaceRange(n.text,t.getCursor()),t.focus(),t.setCursor({line:n.startLine,ch:2})):t.replaceSelection(n.text)},strikethrough:function(e){var t=e.editor,n=t.getSelection();if(""==n){t.replaceRange("~~~~",t.getCursor()),t.focus();var r="~~".length,o=t.getCursor(),i=o.line,a=o.ch;t.setCursor({line:i,ch:a-r})}else t.replaceSelection("~~"+n+"~~")},link:function(e){var t=e.editor,n=t.getSelection();if(""==n){t.replaceRange("[](https://)",t.getCursor()),t.focus();var r=t.getCursor(),o=r.line,i=r.ch;t.setCursor({line:o,ch:i-11})}else t.replaceSelection("["+n+"](https://)")},codeBlock:function(e){var t=e.editor,n=t.selectionStatus();i(n,function(e){var t="``` ";return t+="\n",t+=e,t+="\n",t+="```"}),t.focus(),t.replaceSelection(n.text),t.setCursor({line:n.startLine+1,ch:0})},code:function(e){var t=e.editor,n=t.getSelection();if(""==n){t.replaceRange("``",t.getCursor()),t.focus();var r=t.getCursor(),o=r.line,i=r.ch;t.setCursor({line:o,ch:i-1})}else t.replaceSelection("`"+n+"`")},uncheck:function(e){o(e.editor,!1)},check:function(e){o(e.editor,!0)},table:function(e){var t=e.editor;swal({html:'<input class="swal2-input" placeholder="行"><input class="swal2-input" placeholder="列">',preConfirm:function(){return new Promise(function(e){var t=$(Swal.getContent()).find("input");e([t.eq(0).val(),t.eq(1).val()])})}}).then(function(e){var n=e.value,r=parseInt(n[0])||3,o=parseInt(n[1])||3;o<1&&(o=3),r<1&&(r=3);for(var a="",s=0;s<=r;s++)a+="|    ";a+="\n";for(s=0;s<r;s++)a+="|  -  ";if(a+="|",o>1){a+="\n";for(s=0;s<o-1;s++){for(var c=0;c<=r;c++)a+="|    ";s<o-2&&(a+="\n")}}var l=t.selectionStatus();i(l,function(e){return a}),t.replaceSelection(l.text)}).catch(swal.noop)},search:function(e){e.searchHelper.isVisible()?e.searchHelper.close():e.searchHelper.open()}}}function o(e,t){var n=e.selectionStatus(),r="";""!=n.prev?""==n.next&&(n.prev.startsWith("- [ ] ")||n.prev.startsWith("- [x] "))?r+="\n":r+="\n\n":""==n.prevLine||n.prevLine.startsWith("- [ ] ")||n.prevLine.startsWith("- [x] ")||(r+="\n"),r+=(t?"- [x]  ":"- [ ]  ")+n.selected,""!=n.next?""==n.prev&&(n.next.startsWith("- [ ] ")||n.next.startsWith("- [x] "))?r+="\n":r+="\n\n":""==n.nextLine||n.nextLine.startsWith("- [ ] ")||n.nextLine.startsWith("- [x] ")||(r+="\n"),e.replaceSelection(r)}function i(e,t){var n="";return""!=e.prev?(n+="\n\n",e.startLine+=2):""!=e.prevLine&&(n+="\n",e.startLine+=1),t&&(n+=t(e.selected)),""!=e.next?(n+="\n\n",e.endLine+=2):""!=e.nextLine&&(n+="\n",e.endLine+=1),e.text=n,e}e.prototype.create=function(e){var t=this;this.wrapperInstance.wrapper&&this.wrapperInstance.wrapper.remove();var n=new c(e);return n.eventHandlers.push({name:"remove",handler:function(){delete t.wrapperInstance.wrapper}}),this.wrapperInstance.wrapper=n,n},e.prototype.getEditor=function(e){return e.doc?e:e.editor},e.prototype.getWrapper=function(e){return e.doc?e.state.wrapper:e};var e=new e;function c(e){var o=$('<div id="heather_wrapper"><div id="heather_toc"></div><div id="heather_in"><div id="heather_toolbar"></div><textarea  style="width: 100%; height: 100%"></textarea><div id="heather_stat"></div><div id="heather_innerBar"></div></div><div class="markdown-body" id="heather_out"></div></div>');$("body").append(o),this.scrollTop=$(window).scrollTop(),$("body").addClass("heather_noscroll"),$("html").addClass("heather_noscroll"),this.wrapperElement=o[0],this.selectionChangeListeners=[];var i=this;document.onselectionchange=function(){for(var e=0;e<i.selectionChangeListeners.length;e++)try{i.selectionChangeListeners[e].call()}catch(e){console.log(e)}},n||($("#heather_in").show(),$("#heather_out").css({visibility:"visible"})),$("#heather_wrapper").animate({scrollLeft:$("#heather_toc").outerWidth()},0),this.eventHandlers=[],this.themeHandler=m.create(e);var c=this.themeHandler.getTheme();c.render(),this.theme=c;var k=n?"native":"overlay",C=CodeMirror.fromTextArea(document.getElementById("heather_wrapper").querySelector("textarea"),{mode:{name:"gfm"},lineNumbers:!1,matchBrackets:!0,lineWrapping:!0,dragDrop:!0,scrollbarStyle:k,theme:c.editor.theme||"default",styleSelectedText:!0,extraKeys:{Enter:"newlineAndIndentContinueMarkdownList"}});C.setOption("dropContentHandler",function(e,t){var n=e.split(".").pop().toLowerCase();return"md"==n?t:"html"==n||"htm"==n?r.turndown(t):""}),C.setOption("dropContentHandler",function(e,t){var n=e.split(".").pop().toLowerCase();return"md"==n?t:"html"==n||"htm"==n?r.turndown(t):""}),this.theme=c,this.sync=u.create(C,$("#heather_out")[0],e),this.render=d.create(e,c),this.searchHelper=y.create(C),this.cursorHelper=w.create(C),this.tooltip=f.create(C),this.tooltip.enable(),this.toolbar=h.create($("#heather_toolbar")[0]);var x=h.create($("#heather_innerBar")[0]);x.hide(),this.innerBar=x,this.taskListHelper=v.create(this),this.tableHelper=b.create(this);var S,_=this;if(!n){var T,L,H=s(e.render_ms,500);_.onRemove(function(){T&&clearTimeout(T),L&&clearTimeout(L)}),C.on("change",function(){if(T&&clearTimeout(T),T=setTimeout(function(){_.doRender(!0)},H),!1!==e.stat_enable){var t=e.stat_formatter||function(e){return"当前字数："+e.getValue().length};$("#heather_stat").html(t(_)).show(),L&&clearTimeout(L),L=setTimeout(function(){$("#heather_stat").hide()},1e3)}});var E=function(){_.doSync()},q=!1!==e.sync_enable;q&&C.on("scroll",E),this.syncEnable=q,this.scrollHandler=E}if(n){function I(e){return!(!a(e)&&null!=e)||!(function(e){var t=window.getComputedStyle(e)["overflow-x"];return("scroll"===t||"auto"===t)&&e.scrollWidth>e.clientWidth}(e)&&$(e).scrollLeft()>0)&&I(e.parentElement)}$("#heather_toc").touchwipe({wipeLeft:function(){_.toEditor()},min_move_x:10,max_move_y:5}),$(C.getScrollerElement()).touchwipe({wipeLeft:function(){_.toPreview()},wipeRight:function(e){_.toToc()},min_move_x:10,max_move_y:5}),$("#heather_out").touchwipe({wipeRight:function(e){I(e.target)&&_.toEditor()},min_move_x:10,max_move_y:5})}if(_.onRemove(function(){S&&clearTimeout(S)}),$("#heather_toc").on("click","[data-line]",function(){var e=parseInt($(this).data("line"));C.scrollIntoView({line:e}),S=setTimeout(function(){var t=C.charCoords({line:e,ch:0},"local").top;C.scrollTo(null,t),(n||_.fullscreen)&&_.toEditor()},500)}),this.editor=C,this.config=e,this.doRender(!1),!1!==this.config.backup_enable&&(this.backup=p.create(this)),function(e){var n=t?{"Ctrl-B":"bold","Ctrl-I":"italic","Shift-Cmd-T":"table","Ctrl-H":"heading","Ctrl-L":"link","Ctrl-Q":"quote","Shift-Cmd-B":"codeBlock","Shift-Cmd-U":"uncheck","Shift-Cmd-I":"check","Ctrl-S":"search","Cmd-Enter":function(){e.requestFullScreen()}}:{"Ctrl-B":"bold","Ctrl-I":"italic","Alt-T":"table","Ctrl-H":"heading","Ctrl-L":"link","Ctrl-Q":"quote","Alt-B":"codeBlock","Alt-U":"uncheck","Alt-I":"check","Alt-S":"search","Ctrl-Enter":function(){e.requestFullScreen()}};e.bindKey(n)}(this),function(e){for(var t=e.innerBar,n=e.editor,r=e.config,o=$("#heather_innerBar"),i=r.innerBar_icons||["emoji","upload","heading","bold","italic","quote","strikethrough","link","code","code-block","uncheck","check","table","move","undo","redo","close"],a=0;a<i.length;a++){var s=i[a];if("upload"==s&&e.fileUploadEnable()){var c=document.createElement("label");c.setAttribute("class","icon fas fa-upload"),c.setAttribute("style","display: inline-block;"),c.innerHTML='<input type="file" accept="image/*" style="display:none"/>',c.querySelector('input[type="file"]').addEventListener("change",function(){var t=this.files[0];this.value=null,t.name&&l.create(t,e).start()}),t.addElement(c,0)}"emoji"==s&&t.addIcon("far fa-grin-alt icon",function(){e.execCommand("emoji")}),"heading"==s&&t.addIcon("fas fa-heading icon",function(){e.execCommand("heading")}),"bold"==s&&t.addIcon("fas fa-bold icon",function(){e.execCommand("bold")}),"italic"==s&&t.addIcon("fas fa-italic icon",function(){e.execCommand("italic")}),"quote"==s&&t.addIcon("fas fa-quote-left icon",function(){e.execCommand("quote")}),"strikethrough"==s&&t.addIcon("fas fa-strikethrough icon",function(){e.execCommand("strikethrough")}),"link"==s&&t.addIcon("fas fa-link icon",function(){e.execCommand("link")}),"code"==s&&t.addIcon("fas fa-code icon",function(){e.execCommand("code")}),"code-block"==s&&t.addIcon("fas fa-file-code icon",function(){e.execCommand("codeBlock")}),"uncheck"==s&&t.addIcon("far fa-square icon",function(){e.execCommand("uncheck")}),"check"==s&&t.addIcon("far fa-check-square icon",function(){e.execCommand("check")}),"table"==s&&t.addIcon("fas fa-table icon",function(){e.execCommand("table")}),"undo"==s&&t.addIcon("fas fa-undo icon",function(){e.editor.execCommand("undo")}),"redo"==s&&t.addIcon("fas fa-redo icon",function(){e.editor.execCommand("redo")}),"move"==s&&t.addIcon("fas fa-arrows-alt icon pc-hide",function(){e.cursorHelper.open()}),"close"==s&&t.addIcon("fas fa-times icon",function(){t.hide()})}if(CodeMirror.browser.mobile)n.on("cursorActivity",function(){!function(e){var t=n.defaultTextHeight(),r=(s=n.cursorCoords(!0,"local").top)-e.height()-2*t;if(r<0)o.css({top:n.cursorCoords(!0).top+2*t+"px"}),e.show();else{var i=n.getScrollerElement(),a=$(i);if(a[0].scrollHeight-a.scrollTop()-a.outerHeight()<0){var s=n.cursorCoords(!0).top-2*t-e.height()-$("#heather_toolbar").height();s>0?(o.css({top:n.cursorCoords(!0).top-2*t-e.height()+"px"}),e.show()):(o.css({top:n.cursorCoords(!0).top+2*t+"px"}),e.show())}else{n.cursorCoords(!0).top;n.scrollTo(0,r),setTimeout(function(){var r=n.cursorCoords(!0).top,i=r>e.height()+2*t;o.css({top:i?r-2*t-e.height()+"px":r+2*t+"px"}),e.show()},50)}}}(t)}),n.getScrollerElement().addEventListener("touchmove",function(e){t.hide()});else{var d,h=function(){var e=n.defaultTextHeight();o.css({top:n.cursorCoords(!0).top+2*e+"px"}),t.show()};n.on("cursorActivity",h);n.on("change",function(){var e=n.defaultTextHeight(),t=n.cursorCoords(!0,"local").top-301;(!d&&t>0||Math.abs(t-d)>2*e)&&($(n.getScrollerElement()).stop(!0).animate({scrollTop:t},500,function(){h()}),d=t)}),n.getScrollerElement().addEventListener("touchmove",function(e){t.hide()}),n.on("scroll",function(){t.hide()})}}(this),function(e){for(var t,n=e.editor,r=e.theme,o=e.config,i=function(){var i,a=function(t){$(t.target).hasClass("fa-cog")||m(r.toolbar.color,function(t){r.toolbar.color=t,r.render(),e.saveTheme()})},s=function(){m(r.stat.color,function(t){r.stat.color=t,r.render(),e.saveTheme()})},c=function(){m(r.searchHelper.color,function(t){r.searchHelper.color=t,r.render(),e.saveTheme()})},l=function(){m(r.cursorHelper.color,function(t){r.cursorHelper.color=t,r.render(),e.saveTheme()})},d=function(){m(r.bar.color,function(t){r.bar.color=t,r.render(),e.saveTheme()})},h=!1,u=function(){h||async function(){h=!0;const{value:t}=await Swal.fire({input:"select",inputValue:r.editor.theme||"",inputOptions:{"3024-day":"3024-day","3024-night":"3024-night",abcdef:"abcdef","ambiance-mobile":"ambiance-mobile",ambiance:"ambiance","base16-dark":"base16-dark","base16-light":"base16-light",bespin:"bespin",blackboard:"blackboard",cobalt:"cobalt",colorforth:"colorforth",darcula:"darcula",dracula:"dracula","duotone-dark":"duotone-dark","duotone-light":"duotone-light",eclipse:"eclipse",elegant:"elegant","erlang-dark":"erlang-dark","gruvbox-dark":"gruvbox-dark",hopscotch:"hopscotch",icecoder:"icecoder",idea:"idea",isotope:"isotope","lesser-dark":"lesser-dark",liquibyte:"liquibyte",lucario:"lucario",material:"material",mbo:"mbo","mdn-like":"mdn-like",midnight:"midnight",monokai:"monokai",neat:"neat",neo:"neo",night:"night","oceanic-next":"oceanic-next","panda-syntax":"panda-syntax","paraiso-dark":"paraiso-dark","paraiso-light":"paraiso-light","pastel-on-dark":"pastel-on-dark",railscasts:"railscasts",rubyblue:"rubyblue",seti:"seti",shadowfox:"shadowfox",solarized:"solarized",ssms:"ssms","the-matrix":"the-matrix","tomorrow-night-bright":"tomorrow-night-bright","tomorrow-night-eighties":"tomorrow-night-eighties",ttcn:"ttcn",twilight:"twilight","vibrant-ink":"vibrant-ink","xq-dark":"xq-dark","xq-light":"xq-light",yeti:"yeti",zenburn:"zenburn"},inputPlaceholder:"选择主题",showCancelButton:!0});t&&r.setEditorTheme(n,t,function(){r.render(),e.saveTheme()});setTimeout(function(){h=!1},1e3)}()},f=function(){!async function(){const{value:t}=await Swal.fire({input:"select",inputValue:r.mermaid.theme||"",inputOptions:{default:"default",forest:"forest",dark:"dark",neutral:"neutral"},inputPlaceholder:"选择主题",showCancelButton:!0});t&&(r.mermaid.theme=t,e.saveTheme(),e.doRender(!1),e.doSync())}()},p=!1;var m=function(e,t){!async function(){const{value:e}=await Swal.fire({html:'<div class="_colorpicker"></div>',showCancelButton:!0})}();var n=$(Swal.getContent()).find("._colorpicker");n.colorpicker({inline:!0,container:!0,template:'<div class="colorpicker"><div class="colorpicker-saturation"><i class="colorpicker-guide"></i></div><div class="colorpicker-hue"><i class="colorpicker-guide"></i></div><div class="colorpicker-alpha">   <div class="colorpicker-alpha-color"></div>   <i class="colorpicker-guide"></i></div></div>'}),e&&n.colorpicker("setValue",e),n.on("colorpickerChange",function(e){e.color&&t&&t(e.color.toString())})};return{toggle:function(){return p?(p=!1,i.off("click",d),i.remove(),$("#heather_searchHelper").off("click",c),$("#heather_cursorHelper").off("click",l),$("#heather_searchHelper input").removeAttr("value"),n.off("cursorActivity",u),$("#heather_toolbar").off("click",a),$("#heather_stat").off("click",s),$("#heather_out").off("click",".mermaid",f),$("#heather_stat").text("").hide(),$(".noclick").removeClass("noclick"),n.setOption("readOnly",!1),e.searchHelper.close(),e.cursorHelper.close()):(p=!0,r.clone(),$("<link>").appendTo("head").attr({id:"colorpicker-css",type:"text/css",rel:"stylesheet",href:o.res_colorpickerCss||"colorpicker/dist/css/bootstrap-colorpicker.min.css"}),$("<script>").appendTo("body").attr({id:"colorpicker-js",src:o.res_colorpickerJs||"colorpicker/dist/js/bootstrap-colorpicker.min.js"}),n.setOption("readOnly",!0),$("#heather_searchHelper input").attr("value","点击设置字体颜色"),$("#heather_searchHelper").children().addClass("noclick"),$("#heather_cursorHelper").children().addClass("noclick"),e.searchHelper.open(),e.cursorHelper.open(),$("#heather_searchHelper").on("click",c),$("#heather_cursorHelper").on("click",l),$("#heather_toolbar").children().addClass("noclick"),$(t).removeClass("noclick"),$("#heather_toolbar").on("click",a),$("#heather_stat").text("点击设置字体颜色").show(),$("#heather_stat").on("click",s),n.on("cursorActivity",u),$("#heather_out").on("click",".mermaid",f),(i=$("#heather_innerBar").clone()).css({visibility:"visible",top:"100px"}),i.children().addClass("noclick"),$("#heather_in").append(i),i.on("click",d)),p},isThemeMode:function(){return p}}}(),a=o.toolbar_icons||["toc","innerBar","backup","search","config","expand"],s=0;s<a.length;s++){var c=a[s];if("toc"==c&&e.toolbar.addIcon("fas fa-book icon mobile-hide nofullscreen",function(){d()}),"innerBar"==c&&(e.innerBar.keepHidden=!0,e.innerBar.hide(),e.toolbar.addIcon("far icon fa-square",function(e){u(e)})),"search"==c&&e.toolbar.addIcon("fas fa-search icon",function(){e.execCommand("search")}),"backup"==c&&!1!==e.config.backupEnable){e.toolbar.addIcon("fas icon fa-upload ",function(t){e.backup.backup()}),e.toolbar.addIcon("fas icon fa-download ",function(t){f(e.backup)});e.toolbar.addIcon("far fa-file icon",function(t){n=e.backup,Swal.fire({title:"要打开一篇新文档吗?",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33"}).then(e=>{e.value&&n.newDocument()});var n})}"config"==c&&e.toolbar.addIcon("fas icon fa-cog nofullscreen",function(){swal({html:'<input type="checkbox"  />主题编辑模式 <p style="margin-top:0.5rem"><button style="margin-bottom:0.5rem;border: 0;border-radius: .25em;background: initial;background-color: #3085d6;color: #fff;font-size: 1.0625em;margin: .3125em;padding: .625em 2em;font-weight: 500;box-shadow: none;">自定义css</button><button style="margin-bottom:0.5rem;border: 0;border-radius: .25em;background: initial;background-color: #dc3545;color: #fff;font-size: 1.0625em;margin: .3125em;padding: .625em 2em;font-weight: 500;box-shadow: none;">重置主题</button></p>'});var t=$(Swal.getContent().querySelector("input"));t.prop("checked",i.isThemeMode),t.change(function(){i.toggle()});var n=Swal.getContent().querySelectorAll("button");$(n[0]).click(function(){p()}),$(n[1]).click(function(){Swal.fire({title:"确定要重置主题吗?",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33"}).then(t=>{t.value&&e.resetTheme()})})},function(e){t=e}),"expand"==c&&e.toolbar.addIcon("fas fa-expand icon mobile-hide",function(t){$(t).hasClass("fa-expand")?e.requestFullScreen():e.exitFullScreen()},function(t){if(screenfull.enabled){var n=function(){screenfull.isFullscreen?$(t).removeClass("fa-expand").addClass("fa-compress"):$(t).removeClass("fa-compress").addClass("fa-expand")};e.onRemove(function(){screenfull.off("change",n)}),screenfull.on("change",n)}})}var l=!1;function d(){l?e.toEditor(function(){l=!1}):e.toToc(function(){l=!0})}var h=e.innerBar;function u(e){h.keepHidden=!h.keepHidden,h.keepHidden?(h.hide(),$(e).addClass("fa-square").removeClass("fa-check-square")):$(e).addClass("fa-check-square").removeClass("fa-square")}function f(e){for(var t=e.getDocuments(),n=t.length-1;n>=0;n--)if("default"==t[n].title){t.splice(n,1);break}if(0==t.length)swal("没有保存的文档");else{for(var r='<table style="width:100%">',n=0;n<t.length;n++){var o=t[n];r+="<tr><td>"+o.title+'</td><td><i class="fas fa-times" data-title="'+o.title+'" style="margin-right:20px;cursor:pointer"></i><i data-title="'+o.title+'" class="fas fa-arrow-down" style=";cursor:pointer"></i></td><tr>'}r+="</table>",swal({html:r}),$(Swal.getContent()).find(".fa-times").click(function(){var t=$(this).data("title");Swal.fire({title:"确定要删除吗?",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33"}).then(n=>{n.value&&(e.deleteDocument(t),f(e))})}),$(Swal.getContent()).find(".fa-arrow-down").click(function(){var t=$(this).data("title");Swal.fire({title:"确定要加载吗?",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33"}).then(n=>{n.value&&e.loadDocument(t)})})}}function p(){!async function(){const{value:t}=await Swal.fire({input:"textarea",inputPlaceholder:"css",inputValue:r.customCss||"",showCancelButton:!0});t&&(r.customCss=t,r.render(),e.saveTheme())}()}}(this),this.fullscreen=!1,screenfull.enabled){var M=function(){_.fullscreen=screenfull.isFullscreen,function(e,n){if(!CodeMirror.browser.mobile){var r=e.editor,o=r.getWrapperElement(),i=function(t){var n=t.which||t.keyCode;(t.ctrlKey||t.metaKey)&&37==n&&($("#heather_out").removeAttr("tabindex"),e.toEditor(function(){r.focus();var e=r.state.fullScreenRestore;window.scrollTo(e.scrollLeft,e.scrollTop)}))},a=function(t){var n=t.which||t.keyCode;(t.ctrlKey||t.metaKey)&&39==n&&($("#heather_toc").removeAttr("tabindex"),e.toEditor(function(){r.focus();var e=r.state.fullScreenRestore;window.scrollTo(e.scrollLeft,e.scrollTop)}))},s=function(){e.toPreview(function(){$("#heather_out").prop("tabindex",0),$("#heather_out").focus()})},c=function(){e.toToc(function(){$("#heather_toc").prop("tabindex",0),$("#heather_toc").focus()})},l=t?{"Cmd-Right":s,"Cmd-Left":c}:{"Ctrl-Right":s,"Ctrl-Left":c};if(n)e.editor.addKeyMap(l),$("#heather_out").on("keydown",i),$("#heather_toc").on("keydown",a),$(e.getFullScreenElement()).addClass("heather_fullscreen"),r.state.fullScreenRestore={scrollTop:window.pageYOffset,scrollLeft:window.pageXOffset,width:o.style.width,height:o.style.height},o.style.width="",o.style.height="auto",o.className+=" CodeMirror-fullscreen",document.documentElement.style.overflow="hidden",r.refresh();else{e.editor.removeKeyMap(l),$("#heather_out").off("keydown",i),$("#heather_toc").off("keydown",a),$(e.getFullScreenElement()).removeClass("heather_fullscreen"),o.className=o.className.replace(/\s*CodeMirror-fullscreen\b/,""),document.documentElement.style.overflow="";var d=r.state.fullScreenRestore;o.style.width=d.width,o.style.height=d.height,window.scrollTo(d.scrollLeft,d.scrollTop),r.refresh()}e.toEditor(function(){e.doRender(!1)},0)}}(_,screenfull.isFullscreen)};_.onRemove(function(){screenfull.off("change",M)}),screenfull.on("change",M)}this.fileUploadEnable()&&C.on("paste",function(e,t){var n=(t.clipboardData||window.clipboardData).files;if(n.length>0){var r=n[0];if(-1==r.type.indexOf("image/"))return void swal("请上传图片文件");l.create(r,_).start()}}),g(this,"load")}function g(e,t,n){for(var r=0;r<e.eventHandlers.length;r++){var o=e.eventHandlers[r];if(o.name==t)try{o.handler.call(e,n)}catch(e){}}}return c.prototype.fileUploadEnable=function(){return!a(this.config.upload_url)&&!a(this.config.upload_finish)},c.prototype.execCommand=function(t){var n=e.commands[t];a(n)||n.call(null,this)},c.prototype.doRender=function(e){!0!==this.disableRender&&(this.render.renderAt(this.editor.getValue(),$("#heather_out")[0],e),function(){for(var e=$("#heather_out").children("h1,h2,h3,h4,h5,h6"),t=[],n=0;n<e.length;n++){var r=e[n],o=r.tagName.substring(1),i=r.getAttribute("data-line");if(0==t.length)t.push([{indent:o,name:r.textContent,line:i}]);else{var a=t[t.length-1],s=a[0];o>s.indent?a.push({indent:o,name:r.textContent,line:i}):t.push([{indent:o,name:r.textContent,line:i}])}}var c="<h1>TOC</h1><hr>";if(t.length>0)for(var n=0;n<t.length;n++)for(var l=t[n],d=0;d<l.length;d++){var h=l[d],u=h.indent;c+="<h"+u+' data-line="'+h.line+'">'+h.name+"</h"+u+">"}try{var f=document.createElement("div");f.setAttribute("id","heather_toc"),f.innerHTML=c,morphdom($("#heather_toc")[0],f)}catch(e){$("#heather_toc").html(c)}}())},c.prototype.remove=function(){var e=this,t=function(){Swal.close(),g(e,"remove"),$(e.getFullScreenElement()).removeClass("heather_fullscreen"),$("body").removeClass("heather_noscroll"),$("html").removeClass("heather_noscroll"),$("html,body").scrollTop(e.scrollTop),e.wrapperElement.parentNode.removeChild(e.wrapperElement)};this.fullscreen?this.exitFullScreen().then(function(){t()}):t()},c.prototype.doSync=function(){this.sync.doSync()},c.prototype.requestFullScreen=function(){n||(screenfull.enabled?screenfull.request(this.getFullScreenElement()):swal("当前浏览器不支持全屏模式"))},c.prototype.getFullScreenElement=function(){return document.body},c.prototype.exitFullScreen=function(){if(!n&&screenfull.enabled)return screenfull.exit()},c.prototype.enableSync=function(){this.syncEnable||(editor.on("scroll",this.scrollHandler),this.syncEnable=!0)},c.prototype.getHtml=function(){return this.render.getHtml(this.editor.getValue())},c.prototype.getValue=function(){return this.editor.getValue()},c.prototype.setValue=function(e){return this.editor.setValue(e)},c.prototype.disableSync=function(){this.syncEnable&&(editor.off("scroll",this.scrollHandler),this.syncEnable=!1)},c.prototype.on=function(e,t){this.eventHandlers.push({name:e,handler:t})},c.prototype.off=function(e,t){for(var n=0;n<this.eventHandlers.length;n++){if((t=this.eventHandlers[n]).name==e&&t.handler==t){this.eventHandlers.splice(n,1);break}}},c.prototype.onRemove=function(e){this.on("remove",e)},c.prototype.offRemove=function(e){this.off("remove",e)},c.prototype.toEditor=function(e,t){var n=s(t,s(this.config.swipe_animateMs,500));$("#heather_wrapper").animate({scrollLeft:$("#heather_in").width()},n,function(){e&&e()})},c.prototype.toToc=function(e,t){this.editor.unfocus(),n&&this.doRender(!0);var r=s(t,s(this.config.swipe_animateMs,500));$("#heather_wrapper").animate({scrollLeft:0},r,function(){e&&e()})},c.prototype.toPreview=function(e,t){if(n||this.fullscreen){this.editor.unfocus(),n&&(this.doRender(!0),this.doSync());var r=s(t,s(this.config.swipe_animateMs,500));$("#heather_wrapper").animate({scrollLeft:$("#heather_out")[0].offsetLeft},r,function(){e&&e()})}},c.prototype.saveTheme=function(){this.themeHandler.saveTheme(this.theme)},c.prototype.resetTheme=function(){this.editor.setOption("theme","default"),this.theme=this.themeHandler.reset(),this.theme.render()},c.prototype.bindKey=function(t){var n={},r=this;Object.keys(t).forEach(function(o,i){var s=t[o];if("string"==typeof s){var c=e.commands[s];if(!a(c)){n[o]=function(){c.call(null,r)}}}else n[o]=s}),this.editor.addKeyMap(n)},c.prototype.unbindKey=function(e){for(var t=this.editor.state.keyMaps,n=0;n<e.length;n++)for(var r=0;r<t.length;r++)delete t[r][e[n]]},e}()}();
