<!DOCTYPE html>
<html lang="zh-CN">

<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport"
	content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<meta name="description" content="Heather is an online Markdown Editor">
<meta name="keywords" content="Markdown, Heather, Editor, CodeMirror, Github, Open Source">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

 <style>
 #loading{
	font-size:120px;
	color: #fff;
    margin: 0px;
    text-align: center;
	top:calc(50% - 120px);
	width:100%;
 }
 @media (max-width: 768px){
   #loading{
	font-size:80px;
	top:calc(50% - 80px)
   }    
   .markdown-body{
padding:5px !important;
}
}

.github-corner {
    border-bottom: 0;
    position: fixed;
    right: 0;
    text-decoration: none;
    top: 0;
	z-index:9999999;
	display:none;
}

@media print{
	.github-corner {
		display:none !important;
	}
}
.markdown-body{
padding:50px;
}

body{
margin:0px}
 </style>
</head>
<body>

<div id="bg" style="position: absolute;top: 0;left: 0; width: 100vw; height: 100vh;background-color: rgb(40, 33, 28)">
	
</div> 
<div id="loading" style=";position:absolute;left:0;">Heather</div>

<div style="z-index:999;top:0px;position:fixed;width:100%;display:none;border-bottom:1px solid grey;padding-bottom:10px;padding-top:10px;text-align:center;background-color:#fff" id="button-bar">
	
	<i class="fas fa-file-download" id="load-markdown-btn" style="margin-right:20px;cursor:pointer;font-size:20px"></i>
	<i class="far fa-plus-square" id="insert-block-btn" style="margin-right:20px;cursor:pointer;font-size:20px"></i>
	<i class="fas fa-bars" id="context-menu-btn" style="margin-right:20px;cursor:pointer;font-size:20px"></i>
	<i class="fab fa-markdown" id="get-markdown-btn"  style="margin-right:20px;cursor:pointer;font-size:20px"></i>
	<i class="far fa-trash-alt" id="clear-markdown-btn"  style="float:right;cursor:pointer;font-size:20px;margin-right:20px;"></i>
</div>
<div class="markdown-body" style="padding:50px;padding-top:10px;margin-top:40px">
<div id="editor" style="outline:none;min-height:200px;">
<p>this is a paragraph editor ,click & write something here <br>
</div>
</p>
</div>
<script>
var version = '2.0.alpha.1';
function loadJS(callback) {
    var index = 0;
    var site = document.location.href;
    var resources = [];

    function createResource(type, location, url, code,cb) {
        var obj = document.createElement(type);

        if (type === 'script') {
            if (url) obj.src = url+"?v="+version;
            if (code) obj.text = code;
        } else {
            obj.href = url+"?v="+version;
            obj.rel = 'stylesheet';
        }
		if(cb){
			cb(obj);
		}
        obj.location = location;
        obj.onload = indexCount;
        return obj;
    }

    function sendScript(index) {
        return resources[index].location.appendChild(resources[index]);
    }

    function indexCount() {
        if (index < resources.length) {
            sendScript(index);
            index++;
        } else {
			callback();
		}
    }
	

    resources.push(createResource('link', document.head, 'highlight/styles/github.css', null,function(ele){
		ele.setAttribute("media",'all');
	}));
	
    resources.push(createResource('link', document.head, 'css/markdown.css', null,function(ele){
		ele.setAttribute("media",'all');
	}));
    resources.push(createResource('link', document.head, 'fontawesome-free/css/all.min.css', null,function(ele){
		ele.setAttribute("media",'screen');
	}));
    resources.push(createResource('link', document.head, 'css/wysiwyg.css', null,function(ele){
		ele.setAttribute("media",'screen');
	}));
    resources.push(createResource('script', document.body, 'jquery/jquery.min.js?', null));
    resources.push(createResource('script', document.body, 'js/morphdom-umd.min.js', null));
    resources.push(createResource('script', document.body, 'sweet2alert/dist/sweetalert2.all.min.js', null));
    resources.push(createResource('script', document.body, 'js/turndown.js', null));
    resources.push(createResource('script', document.body, 'js/turndown-plugin-gfm.js', null));
    resources.push(createResource('script', document.body, 'highlight/highlight.pack.js', null));
    resources.push(createResource('script', document.body, 'js/jquery.touchwipe.min.js', null));
    resources.push(createResource('script', document.body, 'js/md.js', null));
    resources.push(createResource('script', document.body, 'js/heather_wysiwyg.js', null));
    resources.push(createResource('script', document.body, 'FileSaver.js', null));
    indexCount();
}
</script>
<script>

	loadJS(function(){
		
		$("#bg").remove();
		$("#loading").remove();
		$("#button-bar").show();

		
		var config = {
			///upload for testing
			upload_url:'https://putsreq.com/aPamE6UIaFogo0JwhL6N',
			upload_finish:function(resp){
				Swal.fire('仅供测试上传所用，固定返回同一地址')
				return {
					type : 'video',
					url : 'https://www.qyh.me/video2/news/FEE39819-FF07-45DD-8D8D-D85DE04DB7DC.mov',
					poster:'https://www.qyh.me/video2/news/FEE39819-FF07-45DD-8D8D-D85DE04DB7DC.mov/960'
				};
			},
			upload_fileNameGen:function(file){
			}
		};
		var elem = document.getElementById("editor");
		var editor = Wysiwyg.create(elem,config);
		
		var documentCommandHelper = Wysiwyg.DocumentCommandHelper;
		var commands = Wysiwyg.commands;
		commands['kbd'] = function(){
			Wysiwyg.runInlineCommand(this,function(range,sel){
				documentCommandHelper.inlineTagHandler('KBD',range,sel);
			});
		}
		var keyMap = {};
		keyMap["Ctrl-K"] = "kbd";
		editor.bindKey(keyMap);
		
		var markdown = localStorage.getItem('heather_wysiwyg');
		if(markdown != null){
			editor.setMarkdown(markdown);
		}
		
		document.getElementById('load-markdown-btn').addEventListener('click',function(){
		   async function getMarkdown() {
				const {
					value: markdown
				} = await Swal.fire({
					input: 'textarea',
					inputPlaceholder: '粘贴markdown',
					showCancelButton: true,
					scrollbarPadding :false
				});
				if (markdown) {
					editor.setMarkdown(markdown);
				}
			}
			getMarkdown();
		});
		editor.on('editor.stop',function(){
			localStorage.setItem('heather_wysiwyg',editor.getValue().markdown);
		})
		editor.on('editor.start',function(editor){
			editor.getElement().scrollIntoView({behavior: 'smooth',block:'center'});
		});
		editor.on('editor.embed.start',function(editor){
			editor.getElement().scrollIntoView({behavior: 'smooth',block:'center'});
		})
		document.getElementById('get-markdown-btn').addEventListener('click',function(){
			if(editor.sourceMode === true){
				editor.outSourceMode();
			} else {
				editor.inSourceMode();
			}
		});
		var platform = navigator.platform;
		var userAgent = navigator.userAgent;
		var edge = /Edge\/(\d+)/.exec(userAgent);
		var ios = !edge && /AppleWebKit/.test(userAgent) && /Mobile\/\w+/.test(userAgent)
		var android = /Android/.test(userAgent);
		var mac = ios || /Mac/.test(platform);
		var mobile = ios || android || /webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(userAgent);
	
		var event = mobile?'touchstart' : 'mousedown';
		document.getElementById('clear-markdown-btn').addEventListener(event,function(e){
		
            e.preventDefault();
            e.stopPropagation();
			
		   editor.setHtml('')
		});
		document.getElementById('insert-block-btn').addEventListener(event,function(e){
            e.preventDefault();
            e.stopPropagation();
			
		   editor.execCommand('factories')
		});
		document.getElementById('context-menu-btn').addEventListener(event,function(e){
            e.preventDefault();
            e.stopPropagation();
			
		   editor.execCommand('contextmenu')
		});
	});
</script>
</body>
</html>