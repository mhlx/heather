<!DOCTYPE html>
<html lang="zh-CN">

<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport"
	content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<meta name="description" content="Heather is an online Markdown Editor">
<meta name="keywords" content="Markdown, Heather, Editor, CodeMirror, Github, Open Source">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

 <style>
 #loading{
	font-size:120px;
	color: #fff;
    margin: 0px;
    text-align: center;
	top:calc(50% - 120px);
	width:100%;
 }
 @media (max-width: 768px){
   #loading{
	font-size:80px;
	top:calc(50% - 80px)
   }    
}

.github-corner {
    border-bottom: 0;
    position: fixed;
    right: 0;
    text-decoration: none;
    top: 0;
	z-index:9999999;
	display:none;
}

@media print{
	.github-corner {
		display:none !important;
	}
}
 </style>
</head>
<body>

<a href="https://github.com/mhlx/heather" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#70B7FD; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

<div id="bg" style="position: absolute;top: 0;left: 0; width: 100vw; height: 100vh;background-color: rgb(40, 33, 28)">
	
</div> 
<div id="loading" style=";position:absolute;left:0;">Heather</div>

<div style="margin-bottom:20px;top:0px;position:sticky;display:none" id="button-bar">
	<button  id="load-markdown-btn">load markdown</button>&nbsp;&nbsp;&nbsp;
	<button  id="insert-block-btn">insert block</button>&nbsp;&nbsp;&nbsp;
	<button  id="context-menu-btn">context menu</button>&nbsp;&nbsp;&nbsp;
	<button id="get-markdown-btn">get markdown</button>&nbsp;&nbsp;&nbsp;
	<button id="clear-markdown-btn" style="float:right">clear</button></div>

<a href="https://www.qyh.me/document/heather2.0.md">document</a>
<div id="editor" class="markdown-body" style="outline:none;min-height:200px;border:2px solid black;padding:10px">
<p>this is a paragraph editor ,click & write something here <br>
</p>
</div>
<script>
var version = '2.0.alpha.1';
function loadJS(callback) {
    var index = 0;
    var site = document.location.href;
    var resources = [];

    function createResource(type, location, url, code,cb) {
        var obj = document.createElement(type);

        if (type === 'script') {
            if (url) obj.src = url+"?v="+version;
            if (code) obj.text = code;
        } else {
            obj.href = url+"?v="+version;
            obj.rel = 'stylesheet';
        }
		if(cb){
			cb(obj);
		}
        obj.location = location;
        obj.onload = indexCount;
        return obj;
    }

    function sendScript(index) {
        return resources[index].location.appendChild(resources[index]);
    }

    function indexCount() {
        if (index < resources.length) {
            sendScript(index);
            index++;
        } else {
			callback();
		}
    }
	

    resources.push(createResource('link', document.head, 'highlight/styles/github.css', null,function(ele){
		ele.setAttribute("media",'all');
	}));
    resources.push(createResource('link', document.head, 'css/markdown.css', null,function(ele){
		ele.setAttribute("media",'all');
	}));
    resources.push(createResource('link', document.head, 'fontawesome-free/css/all.min.css', null,function(ele){
		ele.setAttribute("media",'screen');
	}));
    resources.push(createResource('link', document.head, 'css/wysiwyg.css', null,function(ele){
		ele.setAttribute("media",'screen');
	}));
    resources.push(createResource('script', document.body, 'jquery/jquery.min.js?', null));
    resources.push(createResource('script', document.body, 'js/morphdom-umd.min.js', null));
    resources.push(createResource('script', document.body, 'sweet2alert/dist/sweetalert2.all.min.js', null));
    resources.push(createResource('script', document.body, 'js/turndown.js', null));
    resources.push(createResource('script', document.body, 'js/turndown-plugin-gfm.js', null));
    resources.push(createResource('script', document.body, 'highlight/highlight.pack.js', null));
    resources.push(createResource('script', document.body, 'js/jquery.touchwipe.min.js', null));
    resources.push(createResource('script', document.body, 'js/md.js', null));
    resources.push(createResource('script', document.body, 'js/heather_wysiwyg.js', null));
    resources.push(createResource('script', document.body, 'FileSaver.js', null));
    indexCount();
}
</script>
<script>

	loadJS(function(){
		
		$("#bg").remove();
		$("#loading").remove();
		$("#button-bar").show();

		
		var config = {
			///upload for testing
			upload_url:'https://putsreq.com/aPamE6UIaFogo0JwhL6N',
			upload_finish:function(resp){
				swal('仅供测试上传所用，固定返回同一地址')
				return {
					type : 'video',
					url : 'https://www.qyh.me/video2/news/FEE39819-FF07-45DD-8D8D-D85DE04DB7DC.mov',
					poster:'https://www.qyh.me/video2/news/FEE39819-FF07-45DD-8D8D-D85DE04DB7DC.mov/960'
				};
			}
		};
		
		var editor = Wysiwyg.create(document.getElementById("editor"),config);
		
		var documentCommandHelper = Wysiwyg.DocumentCommandHelper;
		var commands = Wysiwyg.commands;
		commands['kbd'] = function(){
			Wysiwyg.runInlineCommand(this,function(range,sel){
				documentCommandHelper.inlineTagHandler('KBD',range,sel);
			});
		}
		var keyMap = {};
		keyMap["Ctrl-K"] = "kbd";
		editor.bindKey(keyMap);
		
		var markdown = localStorage.getItem('heather_wysiwyg');
		if(markdown != null)
			editor.loadMarkdown(markdown);
		
		document.getElementById('load-markdown-btn').addEventListener('click',function(){
		   async function getMarkdown() {
				const {
					value: markdown
				} = await Swal.fire({
					input: 'textarea',
					inputPlaceholder: '粘贴markdown',
					showCancelButton: true
				});
				if (markdown) {
					editor.loadMarkdown(markdown);
				}
			}
			getMarkdown();
		});
		editor.on('editor.stop',function(){
			localStorage.setItem('heather_wysiwyg',editor.getMarkdown());
		})
		document.getElementById('get-markdown-btn').addEventListener('click',function(){
		   Swal.fire({
				input: 'textarea',
				inputAttributes: {
					'readOnly': 'true'
				  },
				inputValue: editor.getMarkdown(),
				showConfirmButton: true
			});
		});
		var platform = navigator.platform;
		var userAgent = navigator.userAgent;
		var edge = /Edge\/(\d+)/.exec(userAgent);
		var ios = !edge && /AppleWebKit/.test(userAgent) && /Mobile\/\w+/.test(userAgent)
		var android = /Android/.test(userAgent);
		var mac = ios || /Mac/.test(platform);
		var mobile = ios || android || /webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(userAgent);
	
		var event = mobile?'touchstart' : 'mousedown';
		document.getElementById('clear-markdown-btn').addEventListener(event,function(e){
		
            e.preventDefault();
            e.stopPropagation();
			
		   editor.loadMarkdown('')
		});
		document.getElementById('insert-block-btn').addEventListener(event,function(e){
            e.preventDefault();
            e.stopPropagation();
			
		   editor.execCommand('factories')
		});
		document.getElementById('context-menu-btn').addEventListener(event,function(e){
            e.preventDefault();
            e.stopPropagation();
			
		   editor.execCommand('contextmenu')
		});
	});
</script>
</body>
</html>